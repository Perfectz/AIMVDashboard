{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://aimusicvideo.local/schemas/reference_guide.json",
  "title": "Visual Reference Guide Schema",
  "description": "Schema for guide.json files that accompany reference images for characters and locations",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
      "description": "Version date in YYYY-MM-DD format"
    },
    "entityType": {
      "type": "string",
      "enum": ["character", "location"],
      "description": "Whether this guide is for a character or location"
    },
    "entityId": {
      "type": "string",
      "pattern": "^(CHAR_|LOC_)[A-Z_]+$",
      "description": "Entity identifier (e.g., CHAR_PROTAGONIST, LOC_NEON_ALLEY)"
    },
    "referenceImages": {
      "type": "array",
      "description": "Reference image metadata",
      "items": {
        "type": "object",
        "required": ["filename", "description"],
        "properties": {
          "filename": {
            "type": "string",
            "pattern": "^ref_\\d{2}\\.(png|jpg|jpeg)$",
            "examples": ["ref_01.png", "ref_02.jpg", "ref_03.png"]
          },
          "description": {
            "type": "string",
            "description": "What this reference image shows",
            "examples": ["Front view, neutral expression, default costume", "Three-quarter view, dramatic lighting", "Full body, environment interaction"]
          },
          "emphasis": {
            "type": "array",
            "items": {"type": "string"},
            "description": "What to pay attention to in this image",
            "examples": [["face structure", "eye color", "hair style"], ["costume details", "color palette"]]
          }
        }
      },
      "minItems": 3,
      "maxItems": 3
    },
    "invariantFeatures": {
      "type": "array",
      "description": "Features that MUST NEVER CHANGE across all prompts",
      "items": {"type": "string"},
      "minItems": 1,
      "examples": [
        ["Character: angular face structure, sharp green eyes, short black hair, black leather jacket"],
        ["Location: flickering neon billboard reading 'ECHO', wet pavement with blue/pink reflections, narrow alley width"]
      ]
    },
    "allowedVariation": {
      "type": "object",
      "description": "What CAN change without breaking identity",
      "properties": {
        "lighting": {
          "type": "object",
          "properties": {
            "allowed": {
              "type": "boolean"
            },
            "notes": {
              "type": "string",
              "examples": ["Can vary from dramatic side-light to overhead neon, but must maintain high-contrast quality"]
            }
          }
        },
        "angle": {
          "type": "object",
          "properties": {
            "allowed": {
              "type": "boolean"
            },
            "notes": {
              "type": "string",
              "examples": ["Any angle OK, but face structure must remain consistent"]
            }
          }
        },
        "distance": {
          "type": "object",
          "properties": {
            "allowed": {
              "type": "boolean"
            },
            "notes": {
              "type": "string",
              "examples": ["From extreme close-up to wide shot, identity must be recognizable at each scale"]
            }
          }
        },
        "expression": {
          "type": "object",
          "properties": {
            "allowed": {
              "type": "boolean"
            },
            "notes": {
              "type": "string",
              "examples": ["Facial expression can vary (neutral, contemplative, surprised, etc.)"]
            }
          }
        },
        "time": {
          "type": "object",
          "properties": {
            "allowed": {
              "type": "boolean"
            },
            "notes": {
              "type": "string",
              "examples": ["Location: Time of day locked to night. No daytime variations."]
            }
          }
        },
        "other": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Other variation notes"
        }
      }
    },
    "promptMatchingStrategy": {
      "type": "object",
      "description": "How to use these references when generating prompts",
      "properties": {
        "imageInputSupported": {
          "type": "boolean",
          "description": "Whether the AI tool accepts image inputs"
        },
        "textMatchingApproach": {
          "type": "string",
          "description": "If no image input, how to match references in text",
          "examples": [
            "Describe invariant features explicitly in every prompt. Mirror reference guide text exactly.",
            "Include all visual anchors from invariantFeatures array in every prompt."
          ]
        }
      }
    },
    "notes": {
      "type": "string",
      "description": "Additional reference notes"
    }
  },
  "required": ["version", "entityType", "entityId", "referenceImages", "invariantFeatures", "allowedVariation"]
}
