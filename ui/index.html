<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Step 5: Prompts - AI Music Video</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="main-layout">
      <nav class="left-nav">
        <div class="nav-brand">
          <h1>Prompt Compiler</h1>
          <p class="nav-subtitle">AI Music Video Project</p>
        </div>

        <div class="project-selector-section">
          <div class="nav-header">
            <div class="nav-title">Current Project</div>
            <button class="btn-icon" id="newProjectBtn" title="New Project">+</button>
          </div>
          <select class="project-dropdown" id="projectSelector">
            <option value="default">Loading...</option>
          </select>
        </div>

        <div class="nav-divider"></div>

        <div class="nav-stats">
          <div class="nav-stat-item"><div class="nav-stat-value" id="stat-shots">0</div><div class="nav-stat-label">Shots</div></div>
          <div class="nav-stat-item"><div class="nav-stat-value" id="stat-prompts">0</div><div class="nav-stat-label">Prompts</div></div>
          <div class="nav-stat-item nav-stat-success"><div class="nav-stat-value" id="stat-passed">0</div><div class="nav-stat-label">Passed</div></div>
          <div class="nav-stat-item nav-stat-error"><div class="nav-stat-value" id="stat-failed">0</div><div class="nav-stat-label">Failed</div></div>
        </div>

        <div class="nav-divider"></div>

        <div class="nav-header"><div class="nav-title">Workflow Steps</div></div>
        <div class="nav-items">
          <button class="nav-item" data-workspace-url="step1.html" data-workspace-title="Step 1: Theme"><span class="nav-icon">01</span><span class="nav-label">Step 1: Theme</span></button>
          <button class="nav-item" data-workspace-url="step2.html" data-workspace-title="Step 2: Music"><span class="nav-icon">02</span><span class="nav-label">Step 2: Music</span></button>
          <button class="nav-item" data-workspace-url="step3.html" data-workspace-title="Step 3: Canon"><span class="nav-icon">03</span><span class="nav-label">Step 3: Canon</span></button>
          <button class="nav-item" data-workspace-url="step4.html" data-workspace-title="Step 4: References"><span class="nav-icon">04</span><span class="nav-label">Step 4: References</span></button>
          <button class="nav-item active" id="promptsNavBtn"><span class="nav-icon">05</span><span class="nav-label">Step 5: Prompts</span><span class="nav-count" id="nav-count-all">0</span></button>
          <button class="nav-item" data-workspace-url="storyboard.html" data-workspace-title="Step 6: Storyboard" id="openStoryboardNavBtn"><span class="nav-icon">06</span><span class="nav-label">Step 6: Storyboard</span></button>
        </div>

        <div class="nav-divider"></div>
        <div class="nav-header"><div class="nav-title">Resources</div></div>
        <div class="nav-items"><button class="nav-item" data-workspace-url="guide.html" data-workspace-title="User Guide" id="openGuideNavBtn"><span class="nav-icon">?</span><span class="nav-label">User Guide</span></button></div>
        <div class="nav-footer"><div class="nav-version">v2026-02-07</div></div>
      </nav>

      <aside class="sidebar" id="shotsSidebar">
        <div class="sidebar-header">
          <div class="sidebar-title-row">
            <h2>Platforms</h2>
            <button class="sidebar-toggle" id="sidebarToggle" title="Collapse sidebar">&#8249;</button>
          </div>
        </div>

        <div class="platform-filters">
          <button class="platform-filter-btn active" data-platform="all"><span class="platform-icon">ALL</span><span class="platform-label">All Prompts</span><span class="platform-count" id="filter-count-all">0</span></button>
          <button class="platform-filter-btn" data-platform="kling"><span class="platform-icon">KL</span><span class="platform-label">Kling 3.0</span><span class="platform-count" id="filter-count-kling">0</span></button>
          <button class="platform-filter-btn" data-platform="nanobanana"><span class="platform-icon">NB</span><span class="platform-label">Nano Banana</span><span class="platform-count" id="filter-count-nanobanana">0</span></button>
          <button class="platform-filter-btn" data-platform="suno"><span class="platform-icon">SU</span><span class="platform-label">Suno</span><span class="platform-count" id="filter-count-suno">0</span></button>
          <button class="platform-filter-btn" data-platform="seedream"><span class="platform-icon">SD</span><span class="platform-label">SeedDream</span><span class="platform-count" id="filter-count-seedream">0</span></button>
        </div>

        <div class="sidebar-divider"></div>

        <div class="sidebar-section-header">
          <h3>Shots</h3>
          <input type="text" id="search" placeholder="Search shots..." class="search-input">
          <select id="lintFilter" class="search-input lint-filter">
            <option value="all">All lint states</option>
            <option value="fail">Failing only</option>
            <option value="pass">Passing only</option>
          </select>
        </div>

        <div class="shot-list" id="shotList"></div>
      </aside>

      <main class="content">
        <div class="page-toolbar">
          <div class="page-toolbar-title">
            <h1>Prompt Review</h1>
            <p>Search, validate, copy, and generate in one place.</p>
          </div>
          <div class="page-toolbar-actions">
            <button id="focusModeBtn" class="btn btn-secondary">Focus Mode</button>
            <button id="commandPaletteBtn" class="btn btn-secondary">Command Menu</button>
          </div>
        </div>

        <div id="promptsWorkspace">
          <nav class="breadcrumbs" id="breadcrumbs" style="display: none;"></nav>

          <div class="empty-state" id="emptyState" style="display: none;">
          <h2>No Prompts Found</h2>
          <p>This is expected in Phase 1.</p>
          <p>Prompts will be generated in Phase 2 after:</p>
          <ul>
            <li>Music is generated</li>
            <li>Shot intents are created</li>
            <li>Canon is filled in (characters, locations)</li>
          </ul>
          <p class="note">To test the UI, create a test prompt file in <code>prompts/kling/</code> or run <code>npm run index</code> to regenerate the index.</p>
          <div class="empty-actions">
            <button id="emptyRunIndex" class="btn btn-primary">Regenerate Index</button>
            <button id="emptyOpenGuide" class="btn btn-secondary">Open Guide</button>
          </div>
          </div>

          <div class="prompt-viewer" id="promptViewer" style="display: none;">
          <div class="prompt-header">
            <h2 id="promptTitle">Shot Title</h2>
            <div class="prompt-meta">
              <span id="promptTool" class="tool-badge"></span>
              <span id="promptLintStatus" class="lint-status"></span>
            </div>
          </div>

          <div class="variation-selector" id="variationSelector" style="display: none;">
            <button class="variation-btn" data-variation="A">Option A</button>
            <button class="variation-btn" data-variation="B">Option B</button>
            <button class="variation-btn" data-variation="C">Option C</button>
            <button class="variation-btn" data-variation="D">Option D</button>
          </div>

          <div class="prompt-actions">
            <button id="copyBtn" class="btn btn-primary">Copy to Clipboard</button>
            <button id="generateShotBtn" class="btn btn-generate" style="display: none;">Generate First + Last Frame</button>
            <span id="copyFeedback" class="copy-feedback"></span>
          </div>

          <div class="prompt-content"><pre id="promptText"></pre></div>

          <div class="shot-renders" id="shotRenders" style="display: none;">
            <div class="shot-renders-header"><h3>Generated Frames</h3></div>
            <div class="shot-renders-grid" id="shotRendersGrid"></div>
          </div>

            <div class="prompt-info">
              <div class="info-row"><strong>File:</strong> <code id="promptFile"></code></div>
              <div class="info-row" id="promptVersionRow" style="display: none;"><strong>Version:</strong> <span id="promptVersion"></span></div>
              <div class="info-row" id="lintErrorsRow" style="display: none;"><strong>Lint Errors:</strong><ul id="lintErrorsList"></ul></div>
            </div>
          </div>
        </div>

        <div class="workspace-shell" id="workspaceShell" style="display:none;">
          <div class="workspace-shell-header">
            <div id="workspaceShellTitle">Workspace</div>
            <button class="btn btn-secondary btn-sm" id="workspaceShellCloseBtn">Back to Prompts</button>
          </div>
          <iframe id="workspaceShellFrame" class="workspace-shell-frame" title="Embedded Workspace"></iframe>
        </div>
      </main>
    </div>
  </div>

  <div class="modal" id="newProjectModal" style="display: none;">
    <div class="modal-overlay" id="newProjectModalOverlay"></div>
    <div class="modal-content">
      <div class="modal-header"><h2>Create New Project</h2><button class="modal-close" id="newProjectModalClose">×</button></div>
      <div class="modal-body">
        <form id="newProjectForm">
          <div class="form-group"><label for="projectName">Project Name *</label><input type="text" id="projectName" required maxlength="100" placeholder="My Music Video" /></div>
          <div class="form-group"><label for="projectDescription">Description</label><textarea id="projectDescription" rows="3" maxlength="500" placeholder="A brief description of your project"></textarea></div>
        </form>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" id="cancelNewProject">Cancel</button><button class="btn btn-primary" id="createNewProject">Create Project</button></div>
    </div>
  </div>

  <div class="modal" id="analysisPromptModal" style="display: none;">
    <div class="modal-overlay" id="analysisPromptModalOverlay"></div>
    <div class="modal-content modal-large">
      <div class="modal-header"><h2>AI Music Analysis Prompt</h2><button class="modal-close" id="analysisPromptModalClose">×</button></div>
      <div class="modal-body">
        <p class="modal-description">Copy this prompt and paste it into another AI (Claude, ChatGPT, etc.) along with your music file. The AI will analyze your music and return a JSON file that you can upload here.</p>
        <div class="prompt-box"><button class="btn btn-primary btn-sm copy-prompt-btn" id="copyAnalysisPromptBtn">Copy Prompt</button><pre id="analysisPromptText">Loading prompt...</pre></div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" id="closeAnalysisPromptModal">Close</button></div>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>
  <div class="command-palette" id="commandPalette" style="display:none;" aria-hidden="true">
    <div class="command-palette-overlay" id="commandPaletteOverlay"></div>
    <div class="command-palette-panel">
      <div class="command-palette-header">Quick Actions</div>
      <button class="command-item" data-command="focus">Toggle Focus Mode</button>
      <button class="command-item" data-command="step1">Open Step 1: Theme</button>
      <button class="command-item" data-command="step2">Open Step 2: Music</button>
      <button class="command-item" data-command="step3">Open Step 3: Canon</button>
      <button class="command-item" data-command="step4">Open Step 4: References</button>
      <button class="command-item" data-command="guide">Open Guide</button>
      <button class="command-item" data-command="storyboard">Go to Storyboard</button>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
